<!DOCTYPE html>
<html>
  <head>
    <title>Managoing Assistants</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <style>
      .label-container {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: left;
        margin: 20px;
      }
      .button-container {
        display: flex;
        flex-direction: row;
        align-items: left;
        margin: 20px;
      }

      .button-container button {
        background-color: rgb(0, 106, 255);
        color: white;
        align-items: left;
      }
      .div-container {
        display: flex;
        flex-direction: row;
        align-items: left;
        margin: 20px;
      }
    </style>
    <!-- jQuery library -->

    <script>
      let data = {
        assistant_id: "",
        file_id: "",
        thread_id: "",
        message: "",
        func_name: "",
        run_id: "",
        status: "",
      };

      function get_data_from_elements() {
        data.assistant_id = document.getElementById("assistant_id").value;
        data.file_id = document.getElementById("file_id").value;
        data.thread_id = document.getElementById("thread_id").value;
        data.message = document.getElementById("message").value;
        data.func_name = document.getElementById("func_name").value;
        data.run_id = document.getElementById("run_id").value;
        data.status = document.getElementById("run_status").value;
      }
      function write_data_to_elements(data) {
        document.getElementById("assistant_id").value = data.assistant_id;
        document.getElementById("file_id").value = data.file_id;
        document.getElementById("thread_id").value = data.thread_id;
        document.getElementById("message").value = data.message;
        document.getElementById("func_name").value = data.func_name;
        document.getElementById("run_id").value = data.run_id;
        document.getElementById("run_status").value = data.status;
      }

      function write_to_div(route, message) {
        console.log(`message in Write to Div: ${JSON.stringify(message)}`);
        let div = document.getElementById("response");
        div.innerHTML = JSON.stringify(message);
      }
      async function sendRequest(route) {
        get_data_from_elements();
        console.log(`sending data: ${JSON.stringify(data)} to ${route}`);
        let response = await fetch(`/${route}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          mode: "cors",
        });
        let res = await response.json();
        console.log(`In UI response: ${JSON.stringify(res)}`);
        await parse_response(route, res);
        return;
      }
      async function parse_response(route, response) {
        data = response.focus;
        write_data_to_elements(data);
        write_to_div(route, response.message);
      }
    </script>
  </head>
  <body>
    <h4>MIT Assistant Builder Mark 1</h4>
    <label for="assistant_id">Assistant ID:</label>
    <div id="assistant" class="button-container">
      <button onclick="sendRequest('create_assistant')">Create</button>
      <button onclick="sendRequest('modify_assistant')">Modify</button>
      <button onclick="sendRequest('list_assistants')">List</button>
      <button onclick="sendRequest('delete_assistant')">Delete</button>
      <input type="text" id="assistant_id" name="assistant_id" />
    </div>
    <label for="file_id">File ID:</label>
    <div id="assistant_file" class="button-container">
      <button onclick="sendRequest('upload_file')">Upload</button>
      <button onclick="sendRequest('create_file')">Create</button>
      <button onclick="sendRequest('list_files')">List</button>
      <button onclick="sendRequest('delete_file')">Delete</button>
      <input type="text" id="file_id" name="file_id" />
    </div>
    <label for="thread_id">Thread ID:</label>
    <div id="thread" class="button-container">
      <button onclick="sendRequest('create_thread')">Create</button>
      <button onclick="sendRequest('delete_thread')">Delete</button>
      <input type="text" id="thread_id" name="thread_id" />
    </div>
    <label for="run_id">Run ID:</label>
    <div class="button-container">
      <button onclick="sendRequest('create_run')">Create</button>
      <button onclick="sendRequest('delete_run')">Cancel Run</button>
      <button onclick="sendRequest('run_status')">Get Status</button>
      <input type="text" id="run_id" name="run_id" />
      <input type="text" id="run_status" name="run_status" />
    </div>
    <label for="message">Messages:</label>
    <div class="button-container">
      <button onclick="sendRequest('create_message')">Create Message</button>
      <button onclick="sendRequest('get_messages')">Get Messages</button>
      <input type="text" id="message" name="message" />
    </div>
    <label for="func_name">Add Tools:</label>
    <div class="button-container">
      <button onclick="sendRequest('list_tools')">Add Tools</button>
      <input type="text" id="func_name" name="func_names" />
    </div>
    <label for="response">Response from GPT:</label>
    <div id="response"></div>
    <div id="functions"></div>
  </body>
</html>
